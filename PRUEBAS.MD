PRUEBAS.md

Este documento describe c√≥mo probar todos los endpoints de la API DSWIntegral, incluyendo autenticaci√≥n, roles y restricciones.

‚∏ª

üöÄ 1. Preparaci√≥n
1.	Clonar y situarse en la carpeta del proyecto.
2.	(Opcional) Establecer entorno en modo Desarrollo:

export ASPNETCORE_ENVIRONMENT=Development


	3.	Restaurar y compilar:

dotnet restore
dotnet build


	4.	Aplicar migraciones:

dotnet ef database update


	5.	Ejecutar la API:

dotnet run


	6.	Swagger UI disponible en:
	‚Ä¢	http://localhost:5000/ (si RoutePrefix = "")
	‚Ä¢	http://localhost:5000/swagger

Tip: En Swagger pulsa el bot√≥n Authorize para ingresar el token y probar rutas protegidas.

‚∏ª

üîë 2. Autenticaci√≥n y Registro (M√≥dulo M6)

2.1 Registro de Usuario
‚Ä¢	Endpoint: POST /api/Auth/register
‚Ä¢	Rol: An√≥nimo
‚Ä¢	Payload de ejemplo:

{
"name": "Test Customer",
"email": "customer@example.com",
"address": "Calle Falsa 123",
"password": "P@ssw0rd!"
}


	‚Ä¢	Respuesta esperada:
	‚Ä¢	200 OK
	‚Ä¢	Body:

{
"token": "<JWT_TOKEN>",
"expires": "2025-07-23T...Z"
}



2.2 Login de Usuario
‚Ä¢	Endpoint: POST /api/Auth/login
‚Ä¢	Rol: An√≥nimo
‚Ä¢	Payload de ejemplo:

{
"email": "customer@example.com",
"password": "P@ssw0rd!"
}


	‚Ä¢	Respuesta esperada:
	‚Ä¢	200 OK
	‚Ä¢	Body igual a register (token + expires).

Con este token podr√°s acceder a rutas protegidas. Guarda <JWT_TOKEN>.

‚∏ª

üë®‚Äçüíº 3. Roles y Restricciones
‚Ä¢	Admin: puede gestionar Productos y actualizar Estado de √ìrdenes.
‚Ä¢	Customer: puede crear y consultar sus √ìrdenes.
‚Ä¢	Invitado: solo puede consultar Productos y Clientes.

Cabecera com√∫n para rutas protegidas:

-H "Authorization: Bearer <JWT_TOKEN>"


‚∏ª

üõ†Ô∏è 4. M1: CRUD Productos

4.1 GET /api/Products (P√∫blico)

curl -i http://localhost:5000/api/Products

	‚Ä¢	200 OK: lista de productos activos.

4.2 GET /api/Products/{id} (P√∫blico)

curl -i http://localhost:5000/api/Products/<PRODUCT_ID>

	‚Ä¢	200 OK o 404 Not Found.

4.3 POST /api/Products (AdminOnly)

curl -i -X POST http://localhost:5000/api/Products \
-H "Content-Type: application/json" \
-H "Authorization: Bearer <ADMIN_TOKEN>" \
-d '{
"sku": "NEW1001",
"name": "Producto Nuevo",
"description": "Descripci√≥n opcional",
"currentUnitPrice": 19.99,
"stockQuantity": 50,
"isActive": true
}'

	‚Ä¢	201 Created + Location header.
	‚Ä¢	403 Forbidden si no es Admin.
	‚Ä¢	400 Bad Request en caso de SKU duplicado o validaci√≥n.

4.4 PUT /api/Products/{id} (AdminOnly)

curl -i -X PUT http://localhost:5000/api/Products/<PRODUCT_ID> \
-H "Content-Type: application/json" \
-H "Authorization: Bearer <ADMIN_TOKEN>" \
-d '{
"id": "<PRODUCT_ID>",
"sku": "UPDATED1001",
"name": "Prod Modificado",
"description": "Nueva descripci√≥n",
"currentUnitPrice": 29.99,
"stockQuantity": 75,
"isActive": true
}'

	‚Ä¢	204 No Content | 400/403/404 seg√∫n el caso.

4.5 PATCH /api/Products/{id} (AdminOnly)

curl -i -X PATCH http://localhost:5000/api/Products/<PRODUCT_ID> \
-H "Authorization: Bearer <ADMIN_TOKEN>"

	‚Ä¢	204 No Content|403/404.

4.6 DELETE /api/Products/{id} (AdminOnly)

curl -i -X DELETE http://localhost:5000/api/Products/<PRODUCT_ID> \
-H "Authorization: Bearer <ADMIN_TOKEN>"

	‚Ä¢	204 No Content|403/404.

‚∏ª

üë• 5. M3: CRUD Clientes

Nota: Estos endpoints son de uso p√∫blico (sin autenticaci√≥n).

5.1 GET /api/Customers

curl -i http://localhost:5000/api/Customers

	‚Ä¢	200 OK: lista de todos los clientes.

5.2 GET /api/Customers/{id}

curl -i http://localhost:5000/api/Customers/<CUSTOMER_ID>

	‚Ä¢	200 OK o 404 Not Found.

5.3 POST /api/Customers

curl -i -X POST http://localhost:5000/api/Customers \
-H "Content-Type: application/json" \
-d '{
"name":"Ana L√≥pez",
"email":"ana@example.com",
"address":"Av. Siempre Viva 742"
}'

	‚Ä¢	201 Created|400 Bad Request.

‚∏ª

üìù 6. M4/M5: CRUD √ìrdenes

Importante: Solo usuarios autenticados (Customer o Admin).

6.1 GET /api/Orders (CustomerOnly)

Lista √≥rdenes del cliente autenticado.

curl -i http://localhost:5000/api/Orders \
-H "Authorization: Bearer <CUSTOMER_TOKEN>"

	‚Ä¢	200 OK + array de OrderResponseDto.
	‚Ä¢	401/403 si no autorizado.

6.2 GET /api/Orders/{id} (CustomerOnly or AdminOnly)

curl -i http://localhost:5000/api/Orders/<ORDER_ID> \
-H "Authorization: Bearer <TOKEN>"

	‚Ä¢	200 OK si el order.CustomerId coincide con el JWT o si es Admin.
	‚Ä¢	404 Not Found si no existe.
	‚Ä¢	403 Forbidden si cliente intenta ver orden ajena.

6.3 POST /api/Orders (CustomerOnly)

curl -i -X POST http://localhost:5000/api/Orders \
-H "Content-Type: application/json" \
-H "Authorization: Bearer <CUSTOMER_TOKEN>" \
-d '{
"shippingAddress":"Calle 123",
"billingAddress":"Av. 456",
"items":[
{"productId":"<PRODUCT_ID>","quantity":2}
]
}'

	‚Ä¢	201 Created + Body OrderResponseDto.
	‚Ä¢	400 Bad Request por validaciones.

6.4 DELETE /api/Orders/{id} (AdminOnly)

curl -i -X DELETE http://localhost:5000/api/Orders/<ORDER_ID> \
-H "Authorization: Bearer <ADMIN_TOKEN>"

	‚Ä¢	204 No Content|404/403.

6.5 PUT /api/Orders/{id}/status (AdminOnly)

curl -i -X PUT http://localhost:5000/api/Orders/<ORDER_ID>/status \
-H "Content-Type: application/json" \
-H "Authorization: Bearer <ADMIN_TOKEN>" \
-d '{"newStatus":"Processing"}'

	‚Ä¢	204 No Content.
	‚Ä¢	400 Bad Request si estado no v√°lido.
	‚Ä¢	404 si no existe.

‚∏ª

üîí 7. M2 Avanzado: CORS, Rate Limiting y CSRF/XSS
‚Ä¢	Rate Limiting: 20 requests/minuto. Ver headers x-rate-limit-*.
‚Ä¢	CSRF/XSS: Asegurado por pol√≠ticas (Token, SameSite, etc).

‚∏ª

Con esta gu√≠a puedes probar exhaustivamente la API seg√∫n roles y m√≥dulos. ¬°√âxitos!